<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개인정보보호·정보보호 업무 네트워크 맵</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .control-btn.active {
            background: #3498db;
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .control-btn:not(.active) {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .search-input {
            padding: 12px 20px;
            border: 2px solid #bdc3c7;
            border-radius: 25px;
            width: 300px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #3498db;
        }

        #network {
            width: 100%;
            height: 800px;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            background: #fafbfc;
            position: relative;
            overflow: hidden;
        }

        .area-label {
            font-size: 18px;
            font-weight: bold;
            fill: #2c3e50;
            text-anchor: middle;
            pointer-events: none;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            stroke-width: 3px;
        }

        .node-text {
            font-size: 11px;
            text-anchor: middle;
            pointer-events: none;
            fill: #2c3e50;
            font-weight: 500;
        }

        .link {
            stroke: #95a5a6;
            stroke-width: 1.5;
            stroke-opacity: 0.6;
        }

        .area-boundary {
            fill: none;
            stroke: #3498db;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            stroke-opacity: 0.7;
        }

        .tooltip {
            position: absolute;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 200px;
            z-index: 1000;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #bdc3c7;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>개인정보보호·정보보호 업무 네트워크</h1>
            <p>영역별 업무 흐름과 연관관계를 시각화한 네트워크 맵</p>
        </div>

        <div class="controls">
            <button class="control-btn active" onclick="toggleArea('privacy')">개인정보보호</button>
            <button class="control-btn" onclick="toggleArea('security')">정보보호</button>
            <button class="control-btn" onclick="toggleConnections()">연결선 표시</button>
            <button class="control-btn" onclick="resetView()">전체 보기</button>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="업무나 문서명으로 검색..." onkeyup="searchNodes(this.value)">
        </div>

        <div id="network"></div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>법령·제도</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>업무설계·방침</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>분야별·특수</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>데이터·기술</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span>교육·홍보</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e67e22;"></div>
                <span>인증·평가</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #34495e;"></div>
                <span>사고대응</span>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // 데이터 구조 정의
        const privacyData = {
            nodes: [
                // 법령·제도 확인 (빨간색)
                {id: "A", name: "법령·제도 확인", type: "category", area: "privacy", color: "#e74c3c", size: 25},
                {id: "A1", name: "개인정보 보호 법령 및 지침·고시 해설", type: "document", area: "privacy", color: "#e74c3c", size: 15, category: "A"},
                {id: "A2", name: "위치정보 보호법 해설", type: "document", area: "privacy", color: "#e74c3c", size: 15, category: "A"},
                {id: "A3", name: "긴급상황 시 개인정보 처리 안내서", type: "document", area: "privacy", color: "#e74c3c", size: 15, category: "A"},
                {id: "A4", name: "자동화된 결정 권리 안내서", type: "document", area: "privacy", color: "#e74c3c", size: 15, category: "A"},

                // 업무 설계·처리방침 (주황색)
                {id: "B", name: "업무 설계·처리방침", type: "category", area: "privacy", color: "#f39c12", size: 25},
                {id: "B1", name: "개인정보 처리 통합 안내서", type: "document", area: "privacy", color: "#f39c12", size: 15, category: "B"},
                {id: "B2", name: "개인정보 처리방침 작성 지침", type: "document", area: "privacy", color: "#f39c12", size: 15, category: "B"},
                {id: "B3", name: "홈페이지 개인정보 노출방지 안내서", type: "document", area: "privacy", color: "#f39c12", size: 15, category: "B"},
                {id: "B4", name: "마이데이터 전송 절차 및 기술 가이드라인", type: "document", area: "privacy", color: "#f39c12", size: 15, category: "B"},
                {id: "B5", name: "해외사업자 적용 안내서", type: "document", area: "privacy", color: "#f39c12", size: 15, category: "B"},

                // 분야별/특수 (초록색)
                {id: "C", name: "분야별·특수 처리", type: "category", area: "privacy", color: "#27ae60", size: 25},
                {id: "C1", name: "아동·청소년 개인정보 보호 안내서", type: "document", area: "privacy", color: "#27ae60", size: 15, category: "C"},
                {id: "C2", name: "생체정보 보호 안내서", type: "document", area: "privacy", color: "#27ae60", size: 15, category: "C"},
                {id: "C3", name: "스마트도시 개인정보 보호 안내서", type: "document", area: "privacy", color: "#27ae60", size: 15, category: "C"},
                {id: "C4", name: "자기게시물 접근배제요청권 안내서", type: "document", area: "privacy", color: "#27ae60", size: 15, category: "C"},
                {id: "C5", name: "업종별 개인정보 처리 가이드", type: "document", area: "privacy", color: "#27ae60", size: 15, category: "C"},

                // 데이터 처리·기술적 조치 (파란색)
                {id: "D", name: "데이터·기술적 조치", type: "category", area: "privacy", color: "#3498db", size: 25},
                {id: "D1", name: "합성데이터 생성·활용 안내서", type: "document", area: "privacy", color: "#3498db", size: 15, category: "D"},
                {id: "D2", name: "가명정보 처리 가이드라인", type: "document", area: "privacy", color: "#3498db", size: 15, category: "D"},
                {id: "D3", name: "공공·교육·보건 분야 가명정보 안내서", type: "document", area: "privacy", color: "#3498db", size: 15, category: "D"},
                {id: "D4", name: "AI·데이터 활용 안내서", type: "document", area: "privacy", color: "#3498db", size: 15, category: "D"},
                {id: "D5", name: "개발자 대상 개인정보 보호조치 적용 안내서", type: "document", area: "privacy", color: "#3498db", size: 15, category: "D"},

                // 교육·홍보 (보라색)
                {id: "E", name: "교육·홍보", type: "category", area: "privacy", color: "#9b59b6", size: 25},
                {id: "E1", name: "개인정보 보호 교육 업무 안내서", type: "document", area: "privacy", color: "#9b59b6", size: 15, category: "E"},
                {id: "E2", name: "소상공인을 위한 개인정보 보호 핸드북", type: "document", area: "privacy", color: "#9b59b6", size: 15, category: "E"},
                {id: "E3", name: "개인정보 질의응답 모음집", type: "document", area: "privacy", color: "#9b59b6", size: 15, category: "E"},

                // 인증·평가 (주황색 계열)
                {id: "F", name: "인증·평가", type: "category", area: "privacy", color: "#e67e22", size: 25},
                {id: "F1", name: "개인정보 영향평가 수행 안내서", type: "document", area: "privacy", color: "#e67e22", size: 15, category: "F"},
                {id: "F2", name: "개인정보 영향평가 대가 산정 가이드", type: "document", area: "privacy", color: "#e67e22", size: 15, category: "F"},
                {id: "F3", name: "ISMS-P 인증기준 안내서", type: "document", area: "privacy", color: "#e67e22", size: 15, category: "F"},

                // 사고 대응·취약점 (어두운 회색)
                {id: "G", name: "사고 대응·취약점", type: "category", area: "privacy", color: "#34495e", size: 25},
                {id: "G1", name: "개인정보 유출 등 사고대응 매뉴얼", type: "document", area: "privacy", color: "#34495e", size: 15, category: "G"},
                {id: "G2", name: "침해사고 분석절차 안내서", type: "document", area: "privacy", color: "#34495e", size: 15, category: "G"},

                // 정보보호 영역 (예시 - 실제 데이터로 교체 필요)
                {id: "S1", name: "정보보안 정책", type: "category", area: "security", color: "#2c3e50", size: 25},
                {id: "S1-1", name: "보안 정책 수립 가이드", type: "document", area: "security", color: "#2c3e50", size: 15, category: "S1"},
                {id: "S1-2", name: "접근통제 정책", type: "document", area: "security", color: "#2c3e50", size: 15, category: "S1"},
                
                {id: "S2", name: "기술적 보안", type: "category", area: "security", color: "#16a085", size: 25},
                {id: "S2-1", name: "암호화 가이드라인", type: "document", area: "security", color: "#16a085", size: 15, category: "S2"},
                {id: "S2-2", name: "네트워크 보안 설정", type: "document", area: "security", color: "#16a085", size: 15, category: "S2"},
            ],
            links: [
                // 개인정보보호 영역 내 연결
                {source: "A", target: "A1"}, {source: "A", target: "A2"}, {source: "A", target: "A3"}, {source: "A", target: "A4"},
                {source: "B", target: "B1"}, {source: "B", target: "B2"}, {source: "B", target: "B3"}, {source: "B", target: "B4"}, {source: "B", target: "B5"},
                {source: "C", target: "C1"}, {source: "C", target: "C2"}, {source: "C", target: "C3"}, {source: "C", target: "C4"}, {source: "C", target: "C5"},
                {source: "D", target: "D1"}, {source: "D", target: "D2"}, {source: "D", target: "D3"}, {source: "D", target: "D4"}, {source: "D", target: "D5"},
                {source: "E", target: "E1"}, {source: "E", target: "E2"}, {source: "E", target: "E3"},
                {source: "F", target: "F1"}, {source: "F", target: "F2"}, {source: "F", target: "F3"},
                {source: "G", target: "G1"}, {source: "G", target: "G2"},
                
                // 카테고리 간 연결 (업무 흐름)
                {source: "A", target: "B"}, {source: "B", target: "C"}, {source: "C", target: "D"}, 
                {source: "D", target: "E"}, {source: "E", target: "F"}, {source: "F", target: "G"},
                
                // 교차 연결 (관련 업무)
                {source: "D", target: "F"}, {source: "B", target: "G"}, {source: "C", target: "E"},
                
                // 정보보호 영역 내 연결
                {source: "S1", target: "S1-1"}, {source: "S1", target: "S1-2"},
                {source: "S2", target: "S2-1"}, {source: "S2", target: "S2-2"},
                
                // 영역 간 교차 연결
                {source: "D", target: "S2"}, {source: "G", target: "S1"}, {source: "F3", target: "S1-1"}
            ]
        };

        // SVG 설정
        const width = document.getElementById('network').clientWidth;
        const height = 800;

        const svg = d3.select("#network")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // 영역 정의
        const areas = {
            privacy: { x: width * 0.25, y: height * 0.5, width: width * 0.4, height: height * 0.8 },
            security: { x: width * 0.75, y: height * 0.5, width: width * 0.4, height: height * 0.8 }
        };

        // 영역 경계 그리기
        const areaBoundaries = svg.selectAll(".area-boundary")
            .data(Object.entries(areas))
            .enter()
            .append("rect")
            .attr("class", "area-boundary")
            .attr("x", d => d[1].x - d[1].width/2)
            .attr("y", d => d[1].y - d[1].height/2)
            .attr("width", d => d[1].width)
            .attr("height", d => d[1].height)
            .attr("rx", 20);

        // 영역 라벨
        svg.selectAll(".area-label")
            .data([
                {name: "개인정보보호", x: areas.privacy.x, y: areas.privacy.y - areas.privacy.height/2 + 30},
                {name: "정보보호", x: areas.security.x, y: areas.security.y - areas.security.height/2 + 30}
            ])
            .enter()
            .append("text")
            .attr("class", "area-label")
            .attr("x", d => d.x)
            .attr("y", d => d.y)
            .text(d => d.name);

        // Force simulation 설정
        const simulation = d3.forceSimulation(privacyData.nodes)
            .force("link", d3.forceLink(privacyData.links).id(d => d.id).distance(80))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => d.size + 5))
            .force("area", d3.forceX().x(d => areas[d.area].x).strength(0.3))
            .force("areaY", d3.forceY().y(d => areas[d.area].y).strength(0.3));

        // 링크 그리기
        const link = svg.append("g")
            .selectAll("line")
            .data(privacyData.links)
            .enter()
            .append("line")
            .attr("class", "link");

        // 노드 그리기
        const node = svg.append("g")
            .selectAll("circle")
            .data(privacyData.nodes)
            .enter()
            .append("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => d.color)
            .attr("stroke", "#fff")
            .attr("stroke-width", 2)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip);

        // 노드 텍스트
        const nodeText = svg.append("g")
            .selectAll("text")
            .data(privacyData.nodes)
            .enter()
            .append("text")
            .attr("class", "node-text")
            .text(d => d.name.length > 15 ? d.name.substring(0, 15) + "..." : d.name)
            .attr("dy", d => d.size + 15);

        // 시뮬레이션 업데이트
        simulation.on("tick", () => {
            // 노드를 영역 내에 제한
            privacyData.nodes.forEach(d => {
                const area = areas[d.area];
                d.x = Math.max(area.x - area.width/2 + d.size, Math.min(area.x + area.width/2 - d.size, d.x));
                d.y = Math.max(area.y - area.height/2 + d.size, Math.min(area.y + area.height/2 - d.size, d.y));
            });

            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            nodeText
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });

        // 드래그 함수들
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // 툴팁 함수들
        function showTooltip(event, d) {
            const tooltip = d3.select("#tooltip");
            tooltip.style("opacity", 1)
                .html(`<strong>${d.name}</strong><br/>영역: ${d.area === 'privacy' ? '개인정보보호' : '정보보호'}<br/>유형: ${d.type === 'category' ? '카테고리' : '문서'}`)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function hideTooltip() {
            d3.select("#tooltip").style("opacity", 0);
        }

        // 컨트롤 함수들
        let currentArea = 'privacy';
        let showConnections = true;

        function toggleArea(area) {
            currentArea = area;
            
            // 버튼 상태 업데이트
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // 노드와 링크 필터링
            node.style("opacity", d => d.area === area ? 1 : 0.1);
            nodeText.style("opacity", d => d.area === area ? 1 : 0.1);
            link.style("opacity", d => {
                const sourceArea = privacyData.nodes.find(n => n.id === d.source.id)?.area;
                const targetArea = privacyData.nodes.find(n => n.id === d.target.id)?.area;
                return (sourceArea === area && targetArea === area) ? 0.6 : 0.1;
            });
        }

        function toggleConnections() {
            showConnections = !showConnections;
            link.style("opacity", showConnections ? 0.6 : 0);
            event.target.classList.toggle('active');
        }

        function resetView() {
            currentArea = null;
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            node.style("opacity", 1);
            nodeText.style("opacity", 1);
            link.style("opacity", 0.6);
        }

        function searchNodes(query) {
            if (!query) {
                node.style("opacity", 1);
                nodeText.style("opacity", 1);
                return;
            }

            const lowerQuery = query.toLowerCase();
            node.style("opacity", d => 
                d.name.toLowerCase().includes(lowerQuery) ? 1 : 0.2
            );
            nodeText.style("opacity", d => 
                d.name.toLowerCase().includes(lowerQuery) ? 1 : 0.2
            );
        }

        // 초기 상태: 개인정보보호 영역만 표시
        toggleArea('privacy');
    </script>
</body>
</html>
